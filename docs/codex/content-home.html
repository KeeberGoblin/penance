<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Codex Home - Penance Codex</title>
    <link rel="stylesheet" href="manuscript-style.css">
    <style>
        /* Smooth scrolling with reduced-motion respect */
        html { scroll-behavior: smooth; }
        @media (prefers-reduced-motion: reduce) {
            html { scroll-behavior: auto; }
        }

        /* Anchor offset so headings aren't tight to top */
        h2, h3 { scroll-margin-top: 24px; }

        .recent-updates-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .update-card {
            background: rgba(75, 14, 14, 0.15);
            border-left: 4px solid var(--dark-red);
            padding: 1.5rem;
            border-radius: 2px;
        }

        .update-card .date {
            color: var(--aged-gold);
            font-weight: 700;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
        }

        .update-card p {
            margin: 0;
            line-height: 1.6;
        }

        .dropdown-container {
            margin: 2rem 0;
        }

        .dropdown-toggle {
            background: var(--shadow-black);
            border: 2px solid var(--dark-red);
            color: var(--aged-gold);
            padding: 1rem 1.5rem;
            font-size: 1rem;
            font-family: 'Cinzel', serif;
            cursor: pointer;
            width: 100%;
            text-align: left;
            transition: all 0.3s ease;
            font-weight: 700;
            letter-spacing: 0.05em;
        }

        .dropdown-toggle:hover {
            background: var(--dark-red);
            color: var(--aged-gold);
        }

        .dropdown-toggle::after {
            content: '▼';
            float: right;
            transition: transform 0.3s ease;
        }

        .dropdown-toggle.active::after {
            transform: rotate(180deg);
        }

        .dropdown-content {
            display: none;
            background: rgba(10, 6, 4, 0.5);
            border: 1px solid var(--dark-red);
            border-top: none;
            max-height: 400px;
            overflow-y: auto;
        }

        .dropdown-content.active {
            display: block;
        }

        .update-item {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid rgba(139, 0, 0, 0.2);
            line-height: 1.6;
        }

        .update-item:last-child {
            border-bottom: none;
        }

        .update-item strong {
            color: var(--aged-gold);
        }

        .update-item-date {
            display: inline-block;
            color: var(--aged-gold);
            font-weight: 700;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-right: 0.5rem;
            min-width: 100px;
        }

        /* Table of Contents */
        .toc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0 2rem 0;
        }

        .toc-column {
            background: rgba(10, 6, 4, 0.4);
            border: 1px solid rgba(139, 0, 0, 0.25);
            padding: 1rem 1.25rem;
        }

        .toc-column h3 {
            font-family: 'Cinzel Decorative', serif;
            color: var(--aged-gold);
            font-size: 1.1rem;
            margin: 0 0 0.5rem 0;
            padding-bottom: 0.35rem;
            border-bottom: 2px solid var(--dark-red);
        }

        .toc-column ul {
            margin: 0.5rem 0 0 1rem;
            padding: 0;
        }

        .toc-column li {
            margin: 0.25rem 0;
            line-height: 1.4;
        }

        /* Collapsible TOC on small screens */
        .toc-column.collapsible h3 {
            cursor: pointer;
            position: relative;
        }
        .toc-column.collapsible h3::after {
            content: '+';
            position: absolute;
            right: 0;
            top: 0;
            color: var(--aged-gold);
        }
        .toc-column.collapsible.open h3::after {
            content: '–';
        }
        @media (max-width: 800px) {
            .toc-column.collapsible ul { display: none; }
            .toc-column.collapsible.open ul { display: block; }
        }

        /* Mini TOC (sticky, large screens) */
        .mini-toc { display: none !important; }
        .mini-toc h3 {
            font-family: 'Cinzel Decorative', serif;
            color: var(--aged-gold);
            font-size: 1rem;
            margin: 0 0 0.5rem 0;
            border-bottom: 2px solid var(--dark-red);
            padding-bottom: 0.35rem;
        }
        .mini-toc ul { margin: 0; padding-left: 1rem; }
        .mini-toc li { margin: 0.25rem 0; }
        .mini-toc a { color: var(--parchment); text-decoration: none; }
        .mini-toc a:hover { color: var(--aged-gold); }
        .mini-toc a.active { color: var(--aged-gold); font-weight: 700; }
        /* No mini-TOC on desktop; global back-to-top control lives in parent frame */

        .back-to-top {
            font-size: 0.85rem;
            margin-left: 0.5rem;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="content">
        <div class="breadcrumb">
            <a href="index.html" target="_parent">CODEX</a> / INDEX
        </div>

        <h1>The Manuscript of Penance</h1>

        <p>Welcome, seeker of the Bound. Herein lies the complete chronicle of Penance: a grimoire of iron, blood, and redemption. Study well these pages, for knowledge is the only armor against the darkness.</p>

        <div style="background: var(--blood-red); border-left: 8px solid var(--dark-red); padding: 2rem; margin: 2.5rem 0;">
            <h2>Playtest Ready: Version 2.0 + Campaign Systems</h2>
            <p>The great work is complete. Ten factions stand ready for battle, their Caskets armed and their souls bound. The campaign systems await those who dare long-term play...with procedural mission generation, 26 faction enemies, 7 anomalous horrors, and the Latin classification of the damned.</p>
            <p><strong>Contents of this Grimoire:</strong></p>
            <ul style="margin-left: 2rem; margin-bottom: 1rem;">
                <li>Setup Time: 15 minutes of preparation</li>
                <li>Battle Duration: 45-60 minutes of bloodshed</li>
                <li>Ten Complete Factions (Church, Dwarves, Ossuarium, Elves, Wyrd, Nomads, Exchange, Bloodlines, Emergent, Crucible)</li>
                <li>24 Support Units with Behavior Decks</li>
                <li>Variable Deck Sizes (26-50 cards, as fate allows)</li>
                <li>60+ Equipment Items (weapons, shields, sigils)</li>
                <li>16 Weapon Move Sets (89 cards of martial technique)</li>
                <li><strong>NEW: Campaign System - Pilot generation, settlement management, 26-enemy core bestiary, 7 anomalous entities, procedural mission generation</strong></li>
            </ul>
            <p><a href="../pdfs/reference-PLAYTEST-READY.pdf" download>→ Download the Complete Playtest Codex (PDF)</a></p>
        </div>

        <h2>For the Uninitiated</h2>

        <p>If you are new to the ways of the Bound, begin your journey here:</p>

        <ul>
            <li><strong><a href="rules-turn-structure.html" target="_parent">Turn Structure</a></strong> - Learn the four phases of combat</li>
            <li><strong><a href="rules-combat-flowchart.html" target="_parent">Combat Flowchart</a></strong> - Visual guide to combat sequence</li>
            <li><strong><a href="rules-common-mistakes.html" target="_parent">Common Mistakes</a></strong> - Avoid the most frequent errors</li>
            <li><strong><a href="rules-deck-construction.html" target="_parent">Deck Construction</a></strong> - Build your deck using the v2.0 formula</li>
            <li><strong><a href="rules-terrain.html" target="_parent">Terrain</a></strong> - Elevation, cover, hazards, and line of sight</li>
            <li><strong><a href="../pdfs/reference-PLAYTEST-READY.pdf" download>Playtest Codex (PDF)</a></strong> - Complete guide with pre-built decks</li>
            <li><strong><a href="scenario-proving-grounds.html" target="_parent">First Blood</a></strong> - The Proving Grounds scenario (45-60 minutes)</li>
            <li><strong><a href="scenario-example-of-play.html" target="_parent">Example of Play</a></strong> - A complete battle walkthrough</li>
        </ul>

        <h2>The Manuscript's Contents</h2>

        <table>
            <thead>
                <tr>
                    <th>CHAPTER</th>
                    <th>CONTENTS</th>
                    <th>STATUS</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Playtest v2.0</strong></td>
                    <td>Complete rules, 4 faction decks, 24 support units, 2 scenarios, dice system</td>
                    <td>✅ Complete</td>
                </tr>
                <tr>
                    <td><strong>Factions (Playable)</strong></td>
                    <td>Church, Dwarves, Ossuarium, Elves - modular equipment (26-50 cards)</td>
                    <td>✅ Complete</td>
                </tr>
                <tr>
                    <td><strong>Support Units</strong></td>
                    <td>24 AI companions with behavior decks (6 per faction)</td>
                    <td>✅ Complete</td>
                </tr>
                <tr>
                    <td><strong>Equipment System</strong></td>
                    <td>60+ weapons, shields, plating, sigils - craftable and lootable</td>
                    <td>✅ Complete</td>
                </tr>
                <tr>
                    <td><strong>Weapon Move Sets</strong></td>
                    <td>16 weapons with complete card sets (89 total cards)</td>
                    <td>✅ Complete</td>
                </tr>
                <tr>
                    <td><strong>Scenarios</strong></td>
                    <td>Proving Grounds (deathmatch), Reliquary Ruins (objective control)</td>
                    <td>✅ Complete</td>
                </tr>
                <tr>
                    <td><strong>Dice System</strong></td>
                    <td>3 custom dice types (Attack, Defense, Suffering) with symbols</td>
                    <td>✅ Complete</td>
                </tr>
                <tr>
                    <td><strong>All 10 Factions Complete</strong></td>
                    <td>Church, Dwarves, Elves, Ossuarium, Wyrd Conclave, Nomads, The Exchange, Vestige Bloodlines, Emergent Syndicate, Crucible Packs (21 cards each, 210 total)</td>
                    <td>✅ Complete</td>
                </tr>
                <tr>
                    <td><strong>Campaign System</strong></td>
                    <td>Pilot generation (5 tables, 320M combinations), pilot skills system (38 skills, faction-specific abilities), settlement phase (6 steps), Core Bestiary (26 enemies), Anomalous Bestiary (7 entities with Latin classifications)</td>
                    <td>✅ Complete</td>
                </tr>
                <tr>
                    <td><strong>Lore & Cosmology</strong></td>
                    <td>437-year timeline, The Sundering, faction histories, species origins, three-layered cosmos</td>
                    <td>✅ Complete</td>
                </tr>
            </tbody>
        </table>

        <h2>Table of Contents</h2>
        <div class="toc-grid" id="tocGrid">
            <div class="toc-column">
                <h3>Rules</h3>
                <ul>
                    <li><a href="rules-turn-structure.html" target="_parent">Turn Structure</a></li>
                    <li><a href="rules-combat.html" target="_parent">Combat</a></li>
                    <li><a href="rules-component-damage.html" target="_parent">Component Damage</a></li>
                    <li><a href="rules-deck-construction.html" target="_parent">Deck Construction</a></li>
                    <li><a href="rules-terrain.html" target="_parent">Terrain</a></li>
                    <li><a href="rules-range-los.html" target="_parent">Range & Line of Sight</a></li>
                    <li><a href="rules-scrap-cards.html" target="_parent">Scrap Cards</a></li>
                    <li><a href="rules-soulstone-energy.html" target="_parent">Soulstone Energy</a></li>
                    <li><a href="rules-thread-snap.html" target="_parent">Thread Snap</a></li>
                    <li><a href="rules-dice.html" target="_parent">Dice</a></li>
                    <li><a href="rules-dice-pool.html" target="_parent">Dice Pool Advantage</a></li>
                    <li><a href="rules-support-as-main.html" target="_parent">Support as Main</a></li>
                    <li><a href="rules-quick-ref.html" target="_parent">Quick Reference</a></li>
                    <li><a href="rules-combat-flowchart.html" target="_parent">Combat Flowchart</a></li>
                    <li><a href="rules-common-mistakes.html" target="_parent">Common Mistakes</a></li>
                    <li><a href="rules-taint-exploitation.html" target="_parent">Taint Exploitation</a></li>
                    <li><a href="rules-v3-optional.html" target="_parent">v3.0 Optional Mechanics</a></li>
                </ul>
            </div>
            <div class="toc-column">
                <h3>Factions</h3>
                <ul>
                    <li><a href="faction-church.html" target="_parent">Church of Absolution</a></li>
                    <li><a href="faction-dwarves.html" target="_parent">Dwarven Forge-Guilds</a></li>
                    <li><a href="faction-undead.html" target="_parent">The Ossuarium</a></li>
                    <li><a href="faction-elves.html" target="_parent">Elven Verdant Covenant</a></li>
                    <li><a href="faction-fae.html" target="_parent">The Wyrd Conclave</a></li>
                    <li><a href="faction-nomads.html" target="_parent">Nomad Collective</a></li>
                    <li><a href="faction-exchange.html" target="_parent">The Exchange</a></li>
                    <li><a href="faction-bloodlines.html" target="_parent">Vestige Bloodlines</a></li>
                    <li><a href="faction-emergent.html" target="_parent">Emergent Syndicate</a></li>
                    <li><a href="faction-crucible.html" target="_parent">Crucible Pacts</a></li>
                    <li><a href="faction-draconid.html" target="_parent">Draconid Remembrance</a></li>
                </ul>
            </div>
            <div class="toc-column">
                <h3>Campaign</h3>
                <ul>
                    <li><a href="campaign-settlement-phase.html" target="_parent">Settlement Phase</a></li>
                    <li><a href="campaign-settlements.html" target="_parent">Settlements</a></li>
                    <li><a href="campaign-pilot-generation.html" target="_parent">Pilot Generation</a></li>
                    <li><a href="campaign-pilot-progression.html" target="_parent">Pilot Progression</a></li>
                    <li><a href="campaign-pilot-skills.html" target="_parent">Pilot Skills</a></li>
                    <li><a href="campaign-pilot-grit.html" target="_parent">Pilot Grit</a></li>
                    <li><a href="campaign-mission-generation.html" target="_parent">Mission Generation</a></li>
                    <li><a href="campaign-loot-tables.html" target="_parent">Loot Tables</a></li>
                    <li><a href="campaign-event-tables.html" target="_parent">Event Tables</a></li>
                    <li><a href="campaign-anomalous-events.html" target="_parent">Anomalous Events</a></li>
                    <li><a href="campaign-flesh-bargains.html" target="_parent">Flesh Bargains</a></li>
                    <li><a href="campaign-scavengers-crusade.html" target="_parent">Scavenger's Crusade</a></li>
                </ul>
            </div>
            <div class="toc-column">
                <h3>Scenarios</h3>
                <ul>
                    <li><a href="scenario-proving-grounds.html" target="_parent">The Proving Grounds</a></li>
                    <li><a href="scenario-reliquary-ruins.html" target="_parent">Reliquary Ruins</a></li>
                    <li><a href="scenario-king-of-the-hill.html" target="_parent">King of the Hill</a></li>
                    <li><a href="scenario-sabotage-mission.html" target="_parent">Sabotage Mission</a></li>
                    <li><a href="scenario-escort-duty.html" target="_parent">Escort Duty</a></li>
                    <li><a href="scenario-example-of-play.html" target="_parent">Example of Play</a></li>
                    <li><a href="scenario-boss-iron-saint.html" target="_parent">Boss: The Iron Saint</a></li>
                    <li><a href="scenario-tutorial-energy-threads.html" target="_parent">Tutorial: Energy & Threads</a></li>
                </ul>
            </div>
            <div class="toc-column">
                <h3>Enemies</h3>
                <ul>
                    <li><a href="enemies-bestiary.html" target="_parent">Bestiary (26)</a></li>
                    <li><a href="enemies-anomalous.html" target="_parent">Anomalous Entities (7)</a></li>
                </ul>
                <h3 style="margin-top: 1rem;">Tools</h3>
                <ul>
                    <li><a href="rulebook-pdf-viewer.html" target="_parent">Core Rulebook (PDF Style)</a></li>
                    <li><a href="gm-helper.html" target="_parent">GM Helper</a></li>
                    <li><a href="player-aid-reference-card.html" target="_parent">Player Aid Reference</a></li>
                    <li><a href="support-units.html" target="_parent">Support Units</a></li>
                    <li><a href="support-equipment.html" target="_parent">Support Equipment</a></li>
                    <li><a href="../cards/" target="_blank" rel="noopener noreferrer">Card Database</a></li>
                    <li><a href="../cards/deck-builder.html" target="_blank" rel="noopener noreferrer">Deck Builder</a></li>
                    <li><a href="../tools/pilot-generator.html" target="_blank" rel="noopener noreferrer">Pilot Generator</a></li>
                    <li><a href="../pdfs/" target="_blank" rel="noopener noreferrer">PDF Downloads</a></li>
                </ul>
            </div>
            <div class="toc-column">
                <h3>Lore</h3>
                <ul>
                    <li><a href="lore-chronicle.html" target="_parent">Chronicle (Timeline)</a></li>
                    <li><a href="cosmology.html" target="_parent">Cosmology</a></li>
                    <li><a href="lore-theslar-overview.html" target="_parent">Theslar Engine</a></li>
                    <li><a href="lore-sundering.html" target="_parent">The Sundering</a></li>
                    <li><a href="lore-pre-sundering.html" target="_parent">Before the Sundering</a></li>
                    <li><a href="lore-year-zero.html" target="_parent">Year Zero</a></li>
                    <li><a href="lore-caskets-overview.html" target="_parent">Caskets Overview</a></li>
                    <li><a href="lore-casket-origins.html" target="_parent">Casket Origins</a></li>
                    <li><a href="lore-casket-manufacturing.html" target="_parent">Casket Manufacturing</a></li>
                    <li><a href="lore-ground-zero.html" target="_parent">Ground Zero</a></li>
                    <li><a href="lore-neural-threads.html" target="_parent">Neural Threads</a></li>
                    <li><a href="lore-engine.html" target="_parent">Engine Doctrine</a></li>
                    <li><a href="lore-soul-binding.html" target="_parent">Soul Binding</a></li>
                    <li><a href="lore-soulstone-system.html" target="_parent">Soulstone System</a></li>
                    <li><a href="lore-soulstone-volatility.html" target="_parent">Soulstone Volatility</a></li>
                    <li><a href="lore-factions-overview.html" target="_parent">Factions Overview</a></li>
                    <li><a href="lore-npcs.html" target="_parent">Iconic NPCs</a></li>
                    <li><a href="lore-void.html" target="_parent">The Void</a></li>
                    <li><a href="lore-climate.html" target="_parent">Climate and Biomes</a></li>
                    <li><a href="lore-bonelord-karath.html" target="_parent">Bonelord Karath</a></li>
                    <li><a href="lore-settlements.html" target="_parent">Settlements</a></li>
                </ul>
            </div>
        </div>

        <h2>Recent Updates to the Codex</h2>
        <p style="opacity: 0.8; font-style: italic; margin-bottom: 1.5rem;">(Top 3 most recent. Past updates archived below.)</p>

        <!-- Top 3 Updates (auto-generated from Past Updates) -->
        <div class="recent-updates-container" id="recentUpdates"></div>

        <!-- Past Updates Dropdown -->
        <div class="dropdown-container">
            <button class="dropdown-toggle" onclick="toggleDropdown()" id="updatesToggle">View Past Updates</button>
            <div class="dropdown-content" id="dropdownContent">
                <div class="update-item">
                    <span class="update-item-date">2025-11-06</span>
                    <strong>PDF-Style Core Rulebook Viewer</strong>, Created a D&D-style parchment rulebook viewer because apparently regular documentation wasn't immersive enough. Features page flipping, bookmarks, and enough medieval aesthetic to make your monitor smell like aged paper. Find it in the Resources nav under "Core Rulebook." Yes, we spent three days on fancy scrollbars. No, we're not sorry.
                </div>
                <div class="update-item">
                    <span class="update-item-date">2025-11-06</span>
                    <strong>Navigation Iframe Fix</strong>, Fixed critical bug where clicking links would break the sidebar navigation, forcing players to manually reload the entire codex like barbarians. The iframe now properly updates without destroying the parent navigation. Our QA tester clicked 847 links to verify this. She's doing well, thanks for asking.
                </div>
                <div class="update-item">
                    <span class="update-item-date">2025-11-05</span>
                    <strong>Notable NPCs for All 10 Factions</strong>, Created 40+ unique NPCs including leaders, zealots, and one completely petrified prophet who's seen three apocalypses and is thoroughly unimpressed by yours. Each faction now has personalities to love, fear, or awkwardly negotiate with.
                </div>
                <div class="update-item">
                    <span class="update-item-date">2025-11-05</span>
                    <strong>Faction Overview Page Uplift</strong>, Fixed Ossuarium being incorrectly called "Lifesteal Vampires" (they're "Necromantic Grinders," thank you very much). Also fixed dropdown menus opening all at once like an accordion convention. Now includes smooth animations, ESC key support, and enough polish to blind a Dwarf.
                </div>
                <div class="update-item">
                    <span class="update-item-date">2025-10-31</span>
                    <strong>Soulstone Sketches (Lore Illustrations)</strong>, Added two hand-drawn diagrams to Soulstone pages with manuscript torn-edge parallax presentation. Sketched by someone who definitely knows what "parallax" means. Definitely.
                </div>
                <div class="update-item">
                    <span class="update-item-date">2025-10-31</span>
                    <strong>Soulstone Volatility Deep-Dive</strong>, Wrote comprehensive guide explaining why Soulstones explode. Spoiler: it's because everything in this game wants to explode. We're starting to see a pattern.
                </div>
                <div class="update-item">
                    <span class="update-item-date">2025-10-25</span>
                    <strong>Pilot Skills System (38 Skills)</strong>, Complete progression system with universal skills + faction-specific abilities. Turns out giving players 38 ways to customize their pilots was "probably enough." Our playtesters disagreed. We're not adding more.
                </div>
                <div class="update-item">
                    <span class="update-item-date">2025-10-25</span>
                    <strong>Combat Flowchart & Common Mistakes Guide</strong>, Added visual flowchart and mistake guide. If you're still confused after this, we can't help you. We tried. We really did.
                </div>
                <div class="update-item">
                    <span class="update-item-date">2025-10-19</span>
                    <strong>Balance Simulation Results</strong>, Church viability improved +93%. Blood Offering cost reduced. Biomass rebalanced. Still no balance. Balance is a lie. We're accepting this now.
                </div>
                <div class="update-item">
                    <span class="update-item-date">2025-10-19</span>
                    <strong>Latin Anomaly Classification</strong>, Replaced SCP terminology with Latin: Sanctus (Safe), Poenitentia (Euclid), Damnatus (Keter), Necessitas (Thaumiel). Because nothing says "apocalyptic horror" quite like dead languages.
                </div>
                <div class="update-item">
                    <span class="update-item-date">2025-10-19</span>
                    <strong>Bestiary Expansion: 26 Enemies + 7 Anomalies</strong>, Added procedural mission generation. Your campaign can now generate infinite missions. "But will it generate FUN missions?" Look, one problem at a time.
                </div>
                <div class="update-item">
                    <span class="update-item-date">2025-10-19</span>
                    <strong>Tactical Map Generator (Python)</strong>, Built gorgeous SVG hex map generator. Input simple text, output professional maps with terrain. It works suspiciously well. We're waiting for the bugs to reveal themselves.
                </div>
                <div class="update-item">
                    <span class="update-item-date">2025-10-19</span>
                    <strong>Comprehensive Codex Cleanup</strong>, Fixed 9 critical issues including "the The" (shameful), outdated faction links, and balance inconsistencies. Turns out proofreading is important. Who knew?
                </div>
                <div class="update-item">
                    <span class="update-item-date">2025-10-17</span>
                    <strong>Major Balance Overhaul</strong>, Component HP normalization, Salvage efficiency nerfed to 3-for-2, overspending cap reduced. We heard you liked painful decisions, so we put painful decisions in your painful decisions.
                </div>
                <div class="update-item">
                    <span class="update-item-date">2025-10-17</span>
                    <strong>Component Damage System</strong>, Added comprehensive system: AP zones, Structure zones, Exposure zones. Three ways to die, one inevitable outcome. The outcome is death. Did we mention death?
                </div>
                <div class="update-item">
                    <span class="update-item-date">2025-10-17</span>
                    <strong>Integrated Draconid Lore</strong>, Added ancient dragon-spawn with apocalyptic memory spanning 50,000 years. They remember the last three world-endings. This one isn't even their worst Tuesday.
                </div>
                <div class="update-item">
                    <span class="update-item-date">2025-10-17</span>
                    <strong>Salvage Economy Rebalance</strong>, Renamed Cannibalize → Salvage and increased cost (1 SCRAP → 1 card became 2 SCRAP → 1 card). Now with 100% more painful decisions.
                </div>
                <div class="update-item">
                    <span class="update-item-date">2025-10-15</span>
                    <strong>Scenario Navigation Fix</strong>, Fixed an issue where players couldn't find individual scenarios in the navigation. Scenarios can now be found! We promise they were there the whole time. Definitely not our fault. Moving on.
                </div>
                <div class="update-item">
                    <span class="update-item-date">2025-10-14</span>
                    <strong>10-Mission Campaign Arc</strong>, Added complete campaign with 5 possible endings. Testers report "concerningly replayable." We consider this a feature, not a bug.
                </div>
                <div class="update-item">
                    <span class="update-item-date">2025-10-14</span>
                    <strong>Pilot Generator Released</strong>, Implemented with 320 million combinations. Statistically, you will never meet another player with the same pilot. We're not sure if that's good.
                </div>
                <div class="update-item">
                    <span class="update-item-date">2025-10-14</span>
                    <strong>AI Behavior Decks</strong>, Created 15 enemies with If-Then AI behavior. They will now predictably ruin your day in approximately 47 different ways.
                </div>
                <div class="update-item">
                    <span class="update-item-date">2025-10-12</span>
                    <strong>Alternate-Earth Cosmology</strong>, Wrote complete cosmology. Answered zero questions, raised 47 more. As intended.
                </div>
                <div class="update-item">
                    <span class="update-item-date">2025-10-12</span>
                    <strong>Support Units System</strong>, Added 24 AI companions with behavior decks. They're allies! Kind of. They might shoot you. It's complicated.
                </div>
                <div class="update-item">
                    <span class="update-item-date">2025-10-12</span>
                    <strong>Weapon Move Sets</strong>, Designed 89 weapon cards across 16 movesets. Turns out swords have a lot of opinions about how to stab things.
                </div>
                <div class="update-item">
                    <span class="update-item-date">2025-10-12</span>
                    <strong>Variable Deck Sizes</strong>, Implemented deck ranges from 26–50 cards (see Deck Construction for the v2.0 formula). Math! So much math! Send help!
                </div>
                <div class="update-item">
                    <span class="update-item-date">2025-10-12</span>
                    <strong>New Factions: Ossuarium & Elves</strong>, Added vampire mechs (Ossuarium) and bleeding assassins (Elves). Balance is a lie we tell ourselves at night.
                </div>
                <div class="update-item">
                    <span class="update-item-date">2025-10-12</span>
                    <strong>Custom Dice System</strong>, Created custom dice with 6 symbols each. Math teachers everywhere are weeping. We're sorry. We're not sorry.
                </div>
                <div class="update-item">
                    <span class="update-item-date">2025-10-11</span>
                    <strong>Random Event Tables</strong>, Wrote 232 tables. Your settlement will now suffer in 232 unique and horrible ways. You're welcome.
                </div>
                <div class="update-item">
                    <span class="update-item-date">2025-10-10</span>
                    <strong>Deck-as-HP System</strong>, Implemented where taking damage discards cards. "But what if we made EVERYTHING hurt?" ...us, probably
                </div>
            </div>
        </div>

        <h2>The Ten Factions of the Bound</h2>

        <table>
            <thead>
                <tr>
                    <th>FACTION</th>
                    <th>PLAYSTYLE</th>
                    <th>CORE MECHANIC</th>
                    <th>SUPPORT UNITS</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><a href="faction-church.html" target="_parent">Church of Absolution</a></td>
                    <td>Aggressive Martyrdom</td>
                    <td>Blood Offering (self-harm for burst damage, infinite scaling)</td>
                    <td>6 units: Flagellants, Penitents, Relic Bearers, Aspirants, Choir, Absolution Engine</td>
                </tr>
                <tr>
                    <td><a href="faction-dwarves.html" target="_parent">Dwarven Forge-Guilds</a></td>
                    <td>Fortress Defender</td>
                    <td>Rune Counters (stack for defense/damage, armor-piercing)</td>
                    <td>6 units: Shield Wall, Artillery, Rune Sentinel, Siege Crawler, Ancestor Golem, Dreadnought</td>
                </tr>
                <tr>
                    <td><a href="faction-undead.html" target="_parent">The Ossuarium</a></td>
                    <td>Necromantic Grinder</td>
                    <td>Soul Harvest & Decay (card recovery, resurrections, corruption accumulation)</td>
                    <td>6 units: Bone Thralls, Grave Knight, Fleshcrafter, Bone Colossus, Lich, Death's Herald</td>
                </tr>
                <tr>
                    <td><a href="faction-elves.html" target="_parent">Elven Verdant Covenant</a></td>
                    <td>Hit-and-Run Assassin</td>
                    <td>Bleed Stacking (infinite scaling, mobility, regeneration)</td>
                    <td>6 units: Thorn Stalkers, Rootweavers, Archers, Briarwood Colossus, Assassin, Ancient Treant</td>
                </tr>
                <tr>
                    <td><a href="faction-fae.html" target="_parent">The Wyrd Conclave</a></td>
                    <td>Reality Bender</td>
                    <td>Wyrd Tokens (reality distortion, stolen faces)</td>
                    <td>6 units: Changelings, Tricksters, Dream Weavers, Bargain Keepers, Fae Lords, Court Herald</td>
                </tr>
                <tr>
                    <td><a href="faction-nomads.html" target="_parent">Nomad Collective</a></td>
                    <td>Mobile Survivor</td>
                    <td>Improvisation (salvaged equipment, movement)</td>
                    <td>3 units: Salvage Crew, Outrider Squadron, Caravan Walker</td>
                </tr>
                <tr>
                    <td><a href="faction-exchange.html" target="_parent">The Exchange</a></td>
                    <td>Economic Warfare</td>
                    <td>Credit Tokens (bribery, mercenaries, resource control)</td>
                    <td>6 units: Enforcers, Negotiators, Mercenary Casket, Trade Caravan, Broker Network, War Profiteer</td>
                </tr>
                <tr>
                    <td><a href="faction-bloodlines.html" target="_parent">Vestige Bloodlines</a></td>
                    <td>Mutation Specialists</td>
                    <td>Biomass Tokens (5 bloodline variants, extinction clock)</td>
                    <td>6 units: Feral Pack, Regenerators, Titan-Strain, Void-Touched, Alpha Mutant, Hive Mother</td>
                </tr>
                <tr>
                    <td><a href="faction-emergent.html" target="_parent">Emergent Syndicate</a></td>
                    <td>Hive-Mind Collective</td>
                    <td>Metamorph Tokens (coordinated swarm, chosen evolution)</td>
                    <td>6 units: Swarm Drones, Metamorphs, Hive Node, Collective Mind, Swarm Nexus, Overmind</td>
                </tr>
                <tr>
                    <td><a href="faction-crucible.html" target="_parent">Crucible Pacts</a></td>
                    <td>Fire Duelist Packs</td>
                    <td>Forge Tokens (volcanic honor duels, ancestral iron)</td>
                    <td>6 units: War Pack, Flamebearers, Iron Champions, Forge Titan, Warmaster, Crucible Engine</td>
                </tr>
                <tr style="opacity: 0.6;">
                    <td><a href="faction-draconid.html" target="_parent">Draconid Remembrance</a></td>
                    <td>Ancient Archivists</td>
                    <td>Memory Shards (apocalypse cycles, petrified knowledge)</td>
                    <td>Not yet inscribed</td>
                </tr>
            </tbody>
        </table>

        <h2>Interactive Tools</h2>

        <p>Digital grimoires to aid your campaign:</p>

        <ul>
            <li><a href="gm-helper.html" target="_parent">GM Helper</a> - Interactive game master tools (loot tables, event generators, NPC creation, encounters, settlements, weather)</li>
            <li><a href="../tools/pilot-generator.html" target="_blank" rel="noopener noreferrer">Pilot Generator</a> - Create unique pilots with random roll or manual select modes (1 in 320 million combinations)</li>
            <li><a href="../cards/deck-builder.html" target="_blank" rel="noopener noreferrer">Deck Builder</a> - Build and customize your Casket's equipment deck</li>
            <li><a href="../cards/" target="_blank" rel="noopener noreferrer">Card Database</a> - Interactive filterable card reference with full statistics</li>
        </ul>

        <h2>External Resources</h2>

        <p>Additional grimoires and reference materials:</p>

        <ul>
            <li><a href="../index.html" target="_blank" rel="noopener noreferrer">Main Website</a> - Presentation site with timeline and faction overview</li>
            <li><a href="../pdfs/" target="_blank" rel="noopener noreferrer">PDF Downloads</a> - Professional codexes of all documentation</li>
            <li><a href="https://github.com/KeeberGoblin/penance" target="_blank" rel="noopener noreferrer">GitHub Repository</a> - Source documents and development</li>
        </ul>

        <h2>Design Philosophy</h2>

        <p>Penance follows brutal design principles:</p>

        <ul>
            <li><strong>Brutal progression</strong> - Permanent consequences matter (component destruction, pilot death, scars)</li>
            <li><strong>Asymmetric factions</strong> - No two play the same (Church ≠ Dwarves ≠ Ossuarium ≠ Elves)</li>
            <li><strong>Mystery over answers</strong> - The lore raises more questions (What is the Theslar Engine?)</li>
            <li><strong>Meaningful scarcity</strong> - Resources are precious (Scrap economy, equipment slots)</li>
            <li><strong>No pure heroes</strong> - Every faction is morally complex (Church burns heretics, Ossuarium harvests souls)</li>
            <li><strong>Death spiral</strong> - Inevitable decline (Damage cards accumulate, component destruction is permanent)</li>
            <li><strong>Support Units</strong> - AI companions with behavior decks (unpredictable allies)</li>
        </ul>

        <h2>Contact the Chronicler</h2>

        <p>Questions, feedback, or reports of heresy:</p>

        <ul>
            <li>GitHub Issues: <a href="https://github.com/KeeberGoblin/penance/issues" target="_blank" rel="noopener noreferrer">Report here</a></li>
            <li>GitHub Discussions: <a href="https://github.com/KeeberGoblin/penance/discussions" target="_blank" rel="noopener noreferrer">Community forum</a></li>
        </ul>

        <div style="background: var(--shadow-black); border: 3px double var(--dark-red); padding: 2rem; margin: 3rem 0; font-style: italic;">
            <p style="text-align: center; margin: 0;" class="no-drop-cap">
                "In iron we seek forgiveness. Through blood, absolution."
            </p>
            <p style="text-align: center; margin-top: 0.5rem; margin-bottom: 0; opacity: 0.7;">
               , The Creed of the Bound
            </p>
        </div>
    </div>

    <script>
        // Top anchor for back-to-top links
        document.addEventListener('DOMContentLoaded', function() {
            document.body.id = document.body.id || 'top';
        });

        function toggleDropdown() {
            const dropdown = document.getElementById('dropdownContent');
            const toggle = document.querySelector('.dropdown-toggle');
            
            dropdown.classList.toggle('active');
            toggle.classList.toggle('active');
        }

        // Build the 'Recent Updates' section from the Past Updates list (top 3 most recent)
        (function buildRecentUpdates() {
            const dropdown = document.getElementById('dropdownContent');
            const recentContainer = document.getElementById('recentUpdates');
            const toggleBtn = document.getElementById('updatesToggle');
            if (!dropdown || !recentContainer) return;

            const items = Array.from(dropdown.querySelectorAll('.update-item'));
            const parsed = items.map(el => {
                const dateStr = (el.querySelector('.update-item-date')?.textContent || '').trim();
                const title = (el.querySelector('strong')?.textContent || '').trim();
                let text = el.textContent.trim();
                // Remove date prefix
                if (dateStr && text.startsWith(dateStr)) {
                    text = text.slice(dateStr.length).trim();
                }
                // Remove title prefix
                if (title && text.startsWith(title)) {
                    text = text.slice(title.length).trim();
                }
                // Remove leading comma
                if (text.startsWith(',')) {
                    text = text.slice(1).trim();
                }
                const d = new Date(dateStr);
                return { date: d, dateStr, title, desc: text };
            }).filter(x => x.date && !isNaN(x.date.getTime()));

            parsed.sort((a, b) => b.date - a.date);
            const top = parsed.slice(0, 3);

            // Render top 3
            recentContainer.innerHTML = top.map(item => {
                const safeTitle = item.title.replace(/</g, '&lt;').replace(/>/g, '&gt;');
                const safeDesc = item.desc.replace(/</g, '&lt;').replace(/>/g, '&gt;');
                return `
                    <div class="update-card">
                        <div class="date">${item.dateStr}</div>
                        <p><strong>${safeTitle}</strong><br>${safeDesc}</p>
                    </div>
                `;
            }).join('');

            // Update toggle label to reflect remaining count
            if (toggleBtn) {
                const remaining = Math.max(parsed.length - 3, 0);
                toggleBtn.textContent = `View Past Updates (${remaining} more entries)`;
            }
        })();

        // Build Mini TOC and Back-to-Top links, and make TOC collapsible on small screens
        (function enhanceNavigation() {
            const content = document.querySelector('.content');
            if (!content) return;

            // Ensure H2s have ids and add Back to top links
            const h2s = Array.from(content.querySelectorAll('h2'));
            const slugify = s => s.toLowerCase()
                                   .replace(/[^a-z0-9\s\-:&]/g, '')
                                   .trim()
                                   .replace(/\s+/g, '-')
                                   .replace(/-+/g, '-');

            h2s.forEach(h => {
                if (!h.id) h.id = slugify(h.textContent || 'section');
                const back = document.createElement('a');
                back.href = '#top';
                back.className = 'back-to-top';
                back.textContent = 'Back to top';
                // Avoid duplicating if re-run
                if (!h.nextElementSibling || !(h.nextElementSibling.classList && h.nextElementSibling.classList.contains('back-to-top'))) {
                    h.insertAdjacentElement('afterend', back);
                }
            });

            // Mini TOC intentionally disabled (desktop FAB in parent frame handles navigation)

            // Collapsible TOC columns on small screens
            const tocGrid = document.getElementById('tocGrid');
            if (tocGrid) {
                const cols = Array.from(tocGrid.querySelectorAll('.toc-column'));
                cols.forEach(col => col.classList.add('collapsible'));

                const applyInitial = () => {
                    const small = window.innerWidth <= 800;
                    cols.forEach(col => {
                        if (small) col.classList.remove('open'); else col.classList.add('open');
                    });
                };

                applyInitial();
                window.addEventListener('resize', applyInitial);

                cols.forEach(col => {
                    const header = col.querySelector('h3');
                    if (!header) return;
                    header.addEventListener('click', () => {
                        const small = window.innerWidth <= 800;
                        if (small) {
                            // Close others, open this one
                            cols.forEach(c => { if (c !== col) c.classList.remove('open'); });
                            col.classList.toggle('open');
                        } else {
                            col.classList.add('open');
                        }
                    });
                });
            }
        })();
    </script>
    <script src="codex-common.js"></script>
</body>
</html>
