<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PENANCE: Support Units & Equipment</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Crimson+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="manuscript-style.css">
    <style>
        /* Additional styles for support unit browser */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --parchment-dark: #1a1410;
            --leather-brown: #2b1f17;
            --blood-red: #4a0e0e;
            --dark-red: #6b1a1a;
            --blackish-red: #2d0a0a;
            --bone-white: #d4c5b0;
            --aged-gold: #b8956a;
            --shadow-black: #0a0604;
        }

        body {
            background-color: var(--parchment-dark);
            background-image: linear-gradient(to bottom, var(--leather-brown) 0%, var(--parchment-dark) 50%, var(--shadow-black) 100%);
            background-attachment: fixed;
            color: var(--bone-white);
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(to bottom, var(--blackish-red), var(--blood-red));
            border-bottom: 3px double var(--dark-red);
            padding: 2rem 3rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.9);
        }

        .header-content {
            max-width: 1800px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            font-family: 'Cinzel Decorative', serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--bone-white);
            text-shadow: 2px 2px 4px var(--shadow-black);
        }

        .header-stats {
            color: var(--aged-gold);
            font-size: 0.9rem;
            text-align: right;
        }

        .main-container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 2rem;
        }

        .sidebar {
            background: linear-gradient(to bottom, var(--leather-brown), var(--parchment-dark));
            border: 2px solid var(--blood-red);
            border-radius: 8px;
            padding: 1.5rem;
            height: fit-content;
            position: sticky;
            top: 120px;
        }

        .filter-section {
            margin-bottom: 1.5rem;
        }

        .filter-title {
            font-family: 'Cinzel Decorative', serif;
            font-size: 1.1rem;
            color: var(--aged-gold);
            margin-bottom: 0.75rem;
            border-bottom: 1px solid var(--dark-red);
            padding-bottom: 0.5rem;
        }

        .filter-option {
            display: flex;
            align-items: center;
            margin: 0.5rem 0;
            cursor: pointer;
            padding: 0.3rem;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .filter-option:hover {
            background: rgba(107, 26, 26, 0.3);
        }

        .filter-option input {
            margin-right: 0.5rem;
        }

        .units-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .unit-card {
            background: linear-gradient(to bottom, var(--leather-brown), var(--parchment-dark));
            border: 2px solid var(--dark-red);
            border-radius: 8px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .unit-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(107, 26, 26, 0.6);
            border-color: var(--aged-gold);
        }

        .unit-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .unit-name {
            font-family: 'Cinzel Decorative', serif;
            font-size: 1.3rem;
            color: var(--aged-gold);
        }

        .unit-faction {
            font-size: 0.8rem;
            color: var(--bone-white);
            background: var(--blood-red);
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
        }

        .unit-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
            margin: 1rem 0;
            padding: 0.75rem;
            background: rgba(26, 20, 16, 0.5);
            border-radius: 4px;
        }

        .stat {
            text-align: center;
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--aged-gold);
            text-transform: uppercase;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--bone-white);
        }

        .unit-theme {
            font-style: italic;
            color: var(--aged-gold);
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .behavior-deck {
            margin-top: 1rem;
            display: none;
        }

        .unit-card.expanded .behavior-deck {
            display: block;
        }

        .behavior-card {
            background: linear-gradient(135deg, var(--blackish-red), var(--blood-red));
            border: 1px solid var(--dark-red);
            border-radius: 4px;
            padding: 1rem;
            margin: 0.75rem 0;
        }

        .behavior-name {
            font-family: 'Cinzel Decorative', serif;
            font-size: 1.1rem;
            color: var(--aged-gold);
            margin-bottom: 0.5rem;
        }

        .behavior-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.8rem;
            margin-bottom: 0.75rem;
            color: var(--bone-white);
        }

        .behavior-effect {
            color: var(--bone-white);
            font-size: 0.9rem;
            line-height: 1.6;
            white-space: pre-line;
        }

        .behavior-flavor {
            font-style: italic;
            color: var(--aged-gold);
            font-size: 0.85rem;
            margin-top: 0.5rem;
            border-top: 1px solid var(--dark-red);
            padding-top: 0.5rem;
        }

        .tab-container {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .tab {
            font-family: 'Cinzel Decorative', serif;
            padding: 0.75rem 1.5rem;
            background: var(--leather-brown);
            border: 2px solid var(--blood-red);
            color: var(--bone-white);
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab.active {
            background: var(--blood-red);
            border-color: var(--aged-gold);
            color: var(--aged-gold);
        }

        .tab:hover {
            background: var(--dark-red);
        }

        .btn-nav {
            background: linear-gradient(135deg, var(--blood-red), var(--blackish-red));
            border: 2px solid var(--aged-gold);
            color: var(--bone-white);
            padding: 0.75rem 1.5rem;
            font-family: 'Cinzel Decorative', serif;
            font-size: 0.9rem;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.6);
        }

        .btn-nav:hover {
            background: linear-gradient(135deg, var(--dark-red), var(--blood-red));
            box-shadow: 0 0 15px rgba(184, 149, 106, 0.5);
            transform: translateY(-2px);
        }

        .expand-hint {
            text-align: center;
            color: var(--aged-gold);
            font-size: 0.8rem;
            margin-top: 1rem;
            opacity: 0.7;
        }

        .unit-card:not(.expanded) .expand-hint::after {
            content: " ▼ Click to expand ▼";
        }

        .unit-card.expanded .expand-hint::after {
            content: " ▲ Click to collapse ▲";
        }

        .equipment-card {
            background: linear-gradient(to bottom, var(--leather-brown), var(--parchment-dark));
            border: 2px solid var(--aged-gold);
            border-radius: 8px;
            padding: 1.5rem;
        }

        .equipment-name {
            font-family: 'Cinzel Decorative', serif;
            font-size: 1.3rem;
            color: var(--aged-gold);
            margin-bottom: 0.5rem;
        }

        .equipment-type {
            font-size: 0.8rem;
            color: var(--bone-white);
            background: var(--blood-red);
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            display: inline-block;
            margin-bottom: 1rem;
        }
            /* Navigation bar for direct page access (not in iframe) */
        .codex-nav {
            display: none;
            background: linear-gradient(135deg, #2b1f17 0%, #1a1410 100%);
            border-bottom: 2px solid var(--aged-gold);
            padding: 0.75rem 1.5rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.5);
        }
        .codex-nav-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 1.5rem;
            flex-wrap: wrap;
        }
        .codex-nav a {
            color: var(--aged-gold);
            text-decoration: none;
            font-family: 'Cinzel', serif;
            font-size: 0.9rem;
            font-weight: 600;
            letter-spacing: 0.05em;
            transition: color 0.3s;
            white-space: nowrap;
        }
        .codex-nav a:hover {
            color: var(--parchment);
        }
        .codex-nav .nav-home {
            color: var(--dark-red);
            font-weight: 700;
        }
        .codex-nav .nav-separator {
            color: var(--medium-brown);
            margin: 0 0.25rem;
        }

</style>
</head>
<body>
    <!-- Navigation bar (only shows when page opened directly, not in iframe) -->
    <nav class="codex-nav" id="codexNav">
        <div class="codex-nav-content">
            <a href="index.html" class="nav-home">← Return to Codex</a>
            <span class="nav-separator">|</span>
            <a href="content-home.html">Home</a>
        </div>
    </nav>
    <script>
        // Show navigation only if page is NOT in an iframe
        if (window.self === window.top) {
            document.getElementById('codexNav').style.display = 'block';
        }
    </script>
    <div class="breadcrumb" style="position: fixed; top: 10px; left: 10px; background: rgba(26,20,16,0.9); padding: 0.5rem 1rem; border-radius: 4px; z-index: 1000;">
    <a href="content-home.html" target="_parent" style="color: #d4c5b0; text-decoration: none;">CODEX</a> /
    <a href="#rules" style="color: #d4c5b0; text-decoration: none;">RULES</a> /
    <span style="color: #b8956a;">Support Equipment</span>
</div>

<div class="header">
        <div class="header-content">
            <div>
                <h1 class="header-title">SUPPORT UNITS & EQUIPMENT</h1>
                <div class="header-stats">
                    <strong id="total-units-count">40+</strong> Support Units |
                    <strong>10</strong> Factions |
                    <strong id="equipment-count">41</strong> Equipment Items
                </div>
            </div>
            <div style="display: flex; gap: 1rem;">
                <a href="../cards/index.html" class="btn-nav">Card Database</a>
                <a href="index.html" class="btn-nav">← Return to Codex</a>
            </div>
        </div>
    </div>

    <div class="main-container">
        <aside class="sidebar">
            <div class="filter-section">
                <div class="filter-title">Category</div>
                <label class="filter-option">
                    <input type="radio" name="category" value="all" checked>
                    <span>All</span>
                </label>
                <label class="filter-option">
                    <input type="radio" name="category" value="support-units">
                    <span>Support Units</span>
                </label>
                <label class="filter-option">
                    <input type="radio" name="category" value="equipment">
                    <span>Equipment</span>
                </label>
            </div>

            <div class="filter-section">
                <div class="filter-title">Faction</div>
                <label class="filter-option">
                    <input type="checkbox" class="faction-filter" value="all" checked>
                    <span>All Factions</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox" class="faction-filter" value="church">
                    <span>Church of Absolution</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox" class="faction-filter" value="crucible">
                    <span>Crucible Pacts</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox" class="faction-filter" value="dwarves">
                    <span>Dwarven Forge-Guilds</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox" class="faction-filter" value="elves">
                    <span>Elven Verdant Covenant</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox" class="faction-filter" value="emergent">
                    <span>Emergent Syndicate</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox" class="faction-filter" value="exchange">
                    <span>The Exchange</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox" class="faction-filter" value="nomads">
                    <span>Nomad Collective</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox" class="faction-filter" value="ossuarium">
                    <span>The Ossuarium</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox" class="faction-filter" value="vestige-bloodlines">
                    <span>Vestige Bloodlines</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox" class="faction-filter" value="wyrd">
                    <span>Wyrd Conclave</span>
                </label>
            </div>

            <div class="filter-section">
                <div class="filter-title">Equipment Slots</div>
                <label class="filter-option">
                    <input type="checkbox" class="slot-filter" value="1" checked>
                    <span>1 Slot</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox" class="slot-filter" value="2" checked>
                    <span>2 Slots</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox" class="slot-filter" value="3" checked>
                    <span>3 Slots</span>
                </label>
                <label class="filter-option">
                    <input type="checkbox" class="slot-filter" value="4" checked>
                    <span>4+ Slots</span>
                </label>
            </div>

        </aside>

        <main>
            <div id="support-units-content" class="units-grid">
                <!-- Support units loading from JSON -->
                <div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: var(--aged-gold); font-family: 'Cinzel', serif;">
                    Loading support units from database...
                </div>
                <div class="unit-card" data-faction="church" data-slots="2" style="display: none;">
                    <div class="unit-header">
                        <div class="unit-name">Flagellant Pack</div>
                        <div class="unit-faction">Church</div>
                    </div>
                    <div class="unit-stats">
                        <div class="stat">
                            <div class="stat-label">HP</div>
                            <div class="stat-value">6</div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">Move</div>
                            <div class="stat-value">4</div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">Def</div>
                            <div class="stat-value">0</div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">Slots</div>
                            <div class="stat-value">2</div>
                        </div>
                    </div>
                    <div class="unit-theme">Self-harming zealots who grow stronger as they suffer</div>
                    <div class="expand-hint"></div>
                    <div class="behavior-deck">
                        <h3 style="font-family: 'Cinzel Decorative', serif; color: var(--aged-gold); margin: 1rem 0;">Behavior Deck (6 Cards)</h3>

                        <div class="behavior-card">
                            <div class="behavior-name">SELF-FLAGELLATION</div>
                            <div class="behavior-meta">
                                <span><strong>Type:</strong> Utility / Self-Harm</span>
                                <span><strong>Priority:</strong> High</span>
                            </div>
                            <div class="behavior-effect">- Flagellants deal 2 damage to themselves
- Gain +2 damage to next attack
- Draw 1 extra Behavior card next turn (frenzy building)</div>
                            <div class="behavior-flavor">"Pain is the path. Suffering is redemption."</div>
                        </div>

                        <div class="behavior-card">
                            <div class="behavior-name">FRENZIED ASSAULT</div>
                            <div class="behavior-meta">
                                <span><strong>Type:</strong> Attack / Reckless</span>
                                <span><strong>Priority:</strong> Critical (HP ≤ 3)</span>
                            </div>
                            <div class="behavior-effect">- Move full speed (4 hexes) toward nearest enemy
- Attack for 6 damage (empowered by pain)
- Ignore Defense on this attack
- Flagellants take 1 damage after attacking (self-destructive)</div>
                            <div class="behavior-flavor">"In their final moments, they are closest to absolution."</div>
                        </div>

                        <div class="behavior-card">
                            <div class="behavior-name">BLEEDING STRIKE</div>
                            <div class="behavior-meta">
                                <span><strong>Type:</strong> Attack</span>
                                <span><strong>Priority:</strong> Medium</span>
                            </div>
                            <div class="behavior-effect">- Move toward nearest enemy within 5 hexes
- If adjacent, attack for 3 damage
- Target gains 1 Bleed counter
- If Flagellants have lost HP this turn, attack deals +2 damage (5 total)</div>
                            <div class="behavior-flavor">"Share the suffering. Make them understand."</div>
                        </div>

                        <div class="behavior-card">
                            <div class="behavior-name">PRAYER OF AGONY</div>
                            <div class="behavior-meta">
                                <span><strong>Type:</strong> Support / Self-Harm</span>
                                <span><strong>Priority:</strong> Medium</span>
                            </div>
                            <div class="behavior-effect">- Flagellants deal 2 damage to themselves
- Choose 1 friendly Casket within 4 hexes
- That Casket recovers 3 cards from discard (your pain heals them)
- Flagellants gain +1 damage to all attacks until end of round</div>
                            <div class="behavior-flavor">"I suffer so you may be cleansed."</div>
                        </div>

                        <div class="behavior-card">
                            <div class="behavior-name">BLOOD FOR BLOOD</div>
                            <div class="behavior-meta">
                                <span><strong>Type:</strong> Reactive / Counterattack</span>
                                <span><strong>Priority:</strong> Reactive (when damaged)</span>
                            </div>
                            <div class="behavior-effect">- When Flagellants are damaged, immediately move 2 hexes toward attacker
- If adjacent after movement, attack for 4 damage
- Flagellants gain Frenzy token (+1 damage to all future attacks, stacks)</div>
                            <div class="behavior-flavor">"Every wound brings me closer to the divine."</div>
                        </div>

                        <div class="behavior-card">
                            <div class="behavior-name">MARTYRDOM CHARGE</div>
                            <div class="behavior-meta">
                                <span><strong>Type:</strong> Attack / Suicide</span>
                                <span><strong>Priority:</strong> Critical (HP ≤ 2)</span>
                            </div>
                            <div class="behavior-effect">- Move full speed toward nearest enemy
- If adjacent, deal 8 damage to that enemy
- Flagellants are immediately destroyed (suicidal explosion)
- All adjacent enemies take 3 splash damage</div>
                            <div class="behavior-flavor">"Through death, I find absolution!"</div>
                        </div>
                    </div>
                </div>

                <!-- More units will be added dynamically -->
                <div style="grid-column: 1/-1; text-align: center; padding: 2rem; color: var(--aged-gold); font-style: italic;">
                    <p>Additional support units loading... This is a demonstration showing the Church Flagellant Pack.</p>
                    <p>Full implementation will load all 40+ support units from faction files.</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Filter functionality
        const factionFilters = document.querySelectorAll('.faction-filter');
        const slotFilters = document.querySelectorAll('.slot-filter');
        const categoryFilters = document.querySelectorAll('input[name="category"]');

        function applyFilters() {
            const selectedFactions = Array.from(factionFilters)
                .filter(f => f.checked && f.value !== 'all')
                .map(f => f.value);

            const selectedSlots = Array.from(slotFilters)
                .filter(f => f.checked)
                .map(f => f.value);

            const showAll = document.querySelector('.faction-filter[value="all"]')?.checked || false;
            const category = document.querySelector('input[name="category"]:checked')?.value || 'all';

            document.querySelectorAll('.unit-card').forEach(card => {
                const cardFaction = card.dataset.faction;
                const cardSlots = card.dataset.slots;
                const cardCategory = card.dataset.category;
                const isEquipment = cardCategory === 'Weapon' || cardCategory === 'Shield' || cardCategory === 'Equipment' || cardCategory === 'Spell Equipment' || !cardSlots;

                // Faction match: handle multi-faction equipment (comma-separated)
                const cardFactions = cardFaction ? cardFaction.split(',').map(f => f.trim()) : [];
                const factionMatch = showAll || selectedFactions.length === 0 ||
                                     selectedFactions.some(f => cardFactions.includes(f)) ||
                                     cardFactions.includes('universal');

                // Slot match: equipment doesn't use slots, so only filter support units by slots
                const slotMatch = isEquipment || selectedSlots.length === 0 || selectedSlots.includes(cardSlots) || (selectedSlots.includes('4') && parseInt(cardSlots) >= 4);

                // Category match: show if category is 'all', or if it matches the card type
                let categoryMatch = category === 'all';
                if (category === 'support-units') {
                    categoryMatch = !isEquipment;
                } else if (category === 'equipment') {
                    categoryMatch = isEquipment;
                }

                card.style.display = (factionMatch && slotMatch && categoryMatch) ? 'block' : 'none';
            });
        }

        factionFilters.forEach(filter => {
            filter.addEventListener('change', () => {
                if (filter.value === 'all') {
                    factionFilters.forEach(f => {
                        if (f.value !== 'all') f.checked = false;
                    });
                } else {
                    document.querySelector('.faction-filter[value="all"]').checked = false;
                }
                applyFilters();
            });
        });

        slotFilters.forEach(filter => filter.addEventListener('change', applyFilters));
        categoryFilters.forEach(filter => filter.addEventListener('change', applyFilters));

        // Load support unit data from JSON
        async function loadSupportUnits() {
            try {
                console.log('Loading support units from JSON...');
                let response;
                try {
                    response = await fetch('../cards/complete-card-data.json');
                } catch (e) {
                    console.log('First path failed, trying alternative...');
                    response = await fetch('../../docs/cards/complete-card-data.json');
                }
                const data = await response.json();

                const supportUnits = data.support_units || [];
                const equipmentItems = data.equipment_items || [];

                console.log(`Loaded ${supportUnits.length} support units`);
                console.log(`Loaded ${equipmentItems.length} equipment items`);

                // Render support units
                renderSupportUnits(supportUnits);

                // Render equipment items
                renderEquipment(equipmentItems);

                // Initialize filters after loading
                applyFilters();
            } catch (error) {
                console.error('Error loading card data:', error);
                // Show error in UI
                document.getElementById('support-units-content').innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: #d4433d;">
                        Error loading support units: ${error.message}
                    </div>
                `;
            }
        }

        function renderSupportUnits(units) {
            const container = document.getElementById('support-units-content');
            container.innerHTML = ''; // Clear demo content

            units.forEach(unit => {
                const card = document.createElement('div');
                card.className = 'unit-card';
                card.dataset.faction = unit.faction;
                card.dataset.slots = unit.equipmentSlots || 0;

                // Unit header
                const header = document.createElement('div');
                header.className = 'unit-header';
                header.innerHTML = `
                    <div class="unit-name">${unit.name}</div>
                    <div class="unit-faction">${capitalize(unit.faction)}</div>
                `;
                card.appendChild(header);

                // Unit stats
                const stats = document.createElement('div');
                stats.className = 'unit-stats';
                stats.innerHTML = `
                    <div class="stat">
                        <div class="stat-label">HP</div>
                        <div class="stat-value">${unit.hp || '?'}</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Move</div>
                        <div class="stat-value">${unit.movement || '?'}</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Defense</div>
                        <div class="stat-value">${unit.defense || 0}</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Slots</div>
                        <div class="stat-value">${unit.equipmentSlots || 0}</div>
                    </div>
                `;
                card.appendChild(stats);

                // Theme
                if (unit.theme) {
                    const theme = document.createElement('div');
                    theme.className = 'unit-theme';
                    theme.textContent = unit.theme;
                    card.appendChild(theme);
                }

                // Add expand hint
                const expandHint = document.createElement('div');
                expandHint.className = 'expand-hint';
                card.appendChild(expandHint);

                // Behavior deck
                if (unit.behaviorCards && unit.behaviorCards.length > 0) {
                    const deck = document.createElement('div');
                    deck.className = 'behavior-deck';
                    deck.innerHTML = `<h3 style="font-family: 'Cinzel Decorative', serif; color: var(--aged-gold); margin: 1rem 0;">Behavior Deck (${unit.behaviorCards.length} Cards)</h3>`;

                    unit.behaviorCards.forEach(behaviorCard => {
                        const behavior = document.createElement('div');
                        behavior.className = 'behavior-card';
                        behavior.innerHTML = `
                            <div class="behavior-name">${behaviorCard.name || 'Unknown Card'}</div>
                            <div class="behavior-meta">
                                ${behaviorCard.type ? `<span><strong>Type:</strong> ${behaviorCard.type}</span>` : ''}
                                ${behaviorCard.priority ? `<span><strong>Priority:</strong> ${behaviorCard.priority}</span>` : ''}
                            </div>
                            ${behaviorCard.effect ? `<div class="behavior-effect">${formatEffect(behaviorCard.effect)}</div>` : ''}
                            ${behaviorCard.flavor ? `<div class="behavior-flavor">"${behaviorCard.flavor}"</div>` : ''}
                        `;
                        deck.appendChild(behavior);
                    });

                    card.appendChild(deck);
                }

                // Add click handler for expansion
                card.addEventListener('click', (e) => {
                    e.stopPropagation();
                    card.classList.toggle('expanded');
                });

                container.appendChild(card);
            });
        }

        function renderEquipment(equipmentItems) {
            const container = document.getElementById('support-units-content');

            equipmentItems.forEach(item => {
                const card = document.createElement('div');
                card.className = 'unit-card'; // Use same styling as support units
                // Store faction data - handle multiple factions
                const factions = item.faction ? item.faction.toLowerCase().split(',').map(f => f.trim()) : ['universal'];
                card.dataset.faction = factions.join(',');
                card.dataset.category = item.category || 'Equipment';

                // Equipment header
                const header = document.createElement('div');
                header.className = 'unit-header';
                header.innerHTML = `
                    <div class="unit-name">${item.name}</div>
                    <div class="unit-faction">${capitalize(item.faction || 'Universal')}</div>
                `;
                card.appendChild(header);

                // Equipment info (weight, crafting cost, etc.)
                const stats = document.createElement('div');
                stats.className = 'unit-stats';
                stats.innerHTML = `
                    ${item.weight ? `<div class="stat">
                        <div class="stat-label">Weight</div>
                        <div class="stat-value">${item.weight}</div>
                    </div>` : ''}
                    ${item.totalCards ? `<div class="stat">
                        <div class="stat-label">Cards</div>
                        <div class="stat-value">${item.totalCards}</div>
                    </div>` : ''}
                    ${item.craftingCost ? `<div class="stat">
                        <div class="stat-label">Crafting</div>
                        <div class="stat-value">${item.craftingCost}</div>
                    </div>` : ''}
                    <div class="stat">
                        <div class="stat-label">Type</div>
                        <div class="stat-value">${item.category}</div>
                    </div>
                `;
                card.appendChild(stats);

                // Add theme/school for spell equipment
                if (item.school) {
                    const theme = document.createElement('div');
                    theme.className = 'unit-theme';
                    theme.textContent = `${item.school} School Magic`;
                    card.appendChild(theme);
                }

                // Add expand hint
                const expandHint = document.createElement('div');
                expandHint.className = 'expand-hint';
                card.appendChild(expandHint);

                // Equipment cards deck (similar to behavior deck)
                if (item.cards && item.cards.length > 0) {
                    const deck = document.createElement('div');
                    deck.className = 'behavior-deck';
                    deck.innerHTML = `<h3 style="font-family: 'Cinzel Decorative', serif; color: var(--aged-gold); margin: 1rem 0;">Equipment Cards (${item.cards.length})</h3>`;

                    item.cards.forEach(equipCard => {
                        const behavior = document.createElement('div');
                        behavior.className = 'behavior-card';
                        behavior.innerHTML = `
                            <div class="behavior-name">${equipCard.name}</div>
                            <div class="behavior-meta">
                                ${equipCard.cost !== undefined ? `<span><strong>Cost:</strong> ${equipCard.cost} SP</span>` : ''}
                                ${equipCard.range ? `<span><strong>Range:</strong> ${equipCard.range}</span>` : ''}
                                ${equipCard.damage !== undefined ? `<span><strong>Damage:</strong> ${equipCard.damage}</span>` : ''}
                                ${equipCard.type ? `<span><strong>Type:</strong> ${equipCard.type}</span>` : ''}
                            </div>
                            ${equipCard.effect ? `<div class="behavior-effect">${equipCard.effect}</div>` : ''}
                        `;
                        deck.appendChild(behavior);
                    });

                    card.appendChild(deck);
                }

                // Add click handler for expansion
                card.addEventListener('click', (e) => {
                    e.stopPropagation();
                    card.classList.toggle('expanded');
                });

                container.appendChild(card);
            });
        }

        function capitalize(str) {
            if (!str) return '';
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        function formatEffect(effect) {
            if (!effect) return '';
            // Convert newlines to <br> for display
            return effect.replace(/\n/g, '<br>').replace(/- /g, '• ');
        }

        // Load data on page load
        loadSupportUnits();
    </script>
    <script src="codex-common.js"></script>
</body>
</html>
